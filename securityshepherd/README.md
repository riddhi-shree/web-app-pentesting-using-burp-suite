# Setting up Burp Suite to work with Security Shepherd

[< Back](../README.md)

## Checkpost-1: Setting up the Target

1. Open '__Oracle VM VirtualBox Manager__'.
2. From the top-left `File` menu, select `Import Appliance` option.

    ![Import Appliance](img/1_importappliance.png)
    ---

3. Select the OVA file `OwaspSecurityShepherdVm_V3.0.ova` to import.

    ![](img/2_selectova.png)
    ![](img/3_selectova.png)
    ---

4. Click on `Import` button.

    ![](img/4_import.png)
    ![](img/5_import.png)
    ---

5. Select the imported appliance and click on `Start` button.

    ![](img/6_imported.png)
    ---

6. Did you encounter an error? If you did, click on `Change Network Settings` button, in the error prompt.

    ![](img/7_error.png)
    ---

7. Ensure that `Adapter 1` settings are set as shown in following image, and then click on `OK` button.

    ![](img/8_vbox_network.png)
    ---

8. On the login prompt, enter credentials as mentioned in `Settings` > `General` > `Description`

    ![](img/10_vbox_login.png)
    ![](img/9_vbox_login.png)
    ---

9. Did you reach here successfully?

    ![](img/11_vbox_login.png)
    ---

10. Obtain IP address of target machine by running the command `ipconfig`. Do you see an IP that looks similar to: `192.168.56.101`?

    ![](img/1_ip.png)
    ---
    
---

## Checkpost-2: Setting up FoxyProxy Addon

1. Check if you have __Firefox browser__ (https://www.mozilla.org/en-US/firefox/new/) installed in your machine.
2. Did you install the __FoxyProxy__ Standard add-on (https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/)? If you did already, skip to step #3.

    ![](img/1_fxpx_addon.png)
    ![](img/2_fxpx_addon.png)
    ![](img/3_fxpx_addon.png)
    ---

3. Open the Firefox browser.
4. Click on `FoxyProxy` icon in the top-right corner of your browser.
5. Select `Options` from the dropdown menu. 
6. Click on `Add` button to add a new __proxy__.

    ![](img/2_fxpx.png)
    ---

7. Enter title as `localhost-8080` (or anything of your choice), IP address as `127.0.0.1`, port as `8080`, and click on the `Save` button.

    ![](img/3_proxy.png)
    ![](img/4_proxy.png)
    ---

8. Enable proxy settings by selecting the option "__Use proxy localhost-8080 for all URLs (ignore patterns)__".

    ![](img/6_proxy.png)
    ---
    ![](img/7_proxy.png)
    ---


## Checkpost-3: Start Burping

1. If you have __Burp Suite__ Community Edition (https://portswigger.net/burp/communitydownload) already installed in your machine, start it now. [Else, download and install Burp Suite in your system first.]

    ![](img/4_burp.png)
    ![](img/5_burp.png)

2. Go to '__Proxy__' tab > '__Options__' sub-tab > '__Proxy Listeners__' section, and validate the proxy listener settings. It should be same as that set in the Firefox browser, i.e., enable a proxy listener for localhost (`127.0.0.1`) on port `8080`.

    ![](img/7_burp.png)
    ---

3. Switch to your Firefox browser and navigate to https://www.google.com
 
    ![](img/8_burp.png)
    ---

4. By now, you should see all your browser (Firefox) traffic going through Burp.

    ![](img/6_burp.png)
    ---


## Checkpost-4: Get rid of unnecessary browser traffic

1. Do you see unnecessary traffic in your site map? Are they originating from Firefox browser itself? We need to get rid of these noise. 

    ![](img/4.png)
    ---
    
2. To disable capturing of unnecessary browser traffic, analyze the traffic in the "Site map" and identify URL patterns that need to be excluded. In the current scenario, we observe that most of the noise is originating from following two domains:
    * `firefox.com`
    * `mozilla.com`

3. In your Firefox browser, click on "FoxyProxy" icon and select "__Options__"

    ![](img/4_fxpx_addon.png)
    ---

4. Choose the recently created proxy (named as, "localhost-8080") and click on "__Patterns__" button.

    ![](img/5_fxpx_addon.png)
    ---

5. In the "Add/Edit Patterns for localhost-8080" window, click on "__New Black__" button, and edit the "Name" and "Pattern" fields as shown below:
    * __1st Black Pattern__:
        * Name: `firefox.com`
        * Pattern: `*.firefox.com`
    * __2nd Black Pattern__:
        * Name: `mozilla.com`
        * Pattern: `*.mozilla.com`

    ![](img/6_fxpx_addon.png)
    ---
    ![](img/7_fxpx_addon.png)
    ---

6. Delete the other (default) patterns listed under "Black Patterns". The final screen should look similar to:

    ![](img/11_fxpx_addon.png)

7. Click on "Save" button and select the option "__Use Enabled Proxies By Patterns and Priority__".

    ![](img/13_fxpx_addon.png)
    ---
    ![](img/12_fxpx_addon.png)
    ---


## Checkpost-5: Installing SSL Certificate

At this point, even though you could intercept most of the HTTP traffic, you might face issues while trying to access secure websites, i.e., websites that follow the "__HTTPS__" protocol. To resolve this issue, you must install _Burp's CA Certificate_ in your Firefox browser.

1. Go to __Burp__ > __Proxy__ > __Intercept__ and disable intercept mode by clicking on the "__Intercept is on__" button.

    ![](img/3_cert.png)
    ![](img/4_cert.png)
    ---

2. Navigate to `http://burp` in your Firefox browser.

    ![](img/2_cert.png)
    ---

3. Click on "CA Certificate" to download the "cacert.der" certificate for Burp.

    ![](img/5_cert.png)
    ---

4. In your running instance of the Firefox browser, go to "Preferences", search for the term "certificates", and click on "View Certificates" button.

    ![](img/6_cert.png)
    ---

5. In the "Certificate Manager" window, click on "Import" button and select the downloaded "cacert.der" file.

    ![](img/7_cert.png)
    ---

6. In the "Downloading Certificate" window prompt, select checkboxes as shown in following image and click on "Ok".

    ![](img/8_cert.png)
    ---

7. Validate if you could access secure websites in proxy mode without any error, by accessing "https://www.google.com" in the Firefox browser with proxy mode enabled.

    ![](img/test_https.png)
    ---

## Checkpost-6: Access your target through Burp Suite

1. Change the URL in your Firefox browser to the IP address of your target application, i.e., enter `192.168.56.101` in the URL address bar and hit ENTER.

    ![](img/9_burp.png)
    ---

2. If you have encountered an insecure connection error, that says "_The owner of 192.168.56.101 has configured their website improperly. ..._", then click on "__Advanced__" > "__Add Exception__"

    ![](img/10_burp.png)
    ---

3. Uncheck the checkbox that says "_Permanently store this exception_", and click on "__Confirm Security Exception__" button.

    ![](img/11_burp.png)
    ---

4. Did you meet the __Security Shepherd__? Let's get some secrets out...

    ![](img/12_burp.png)
    ---
---

[< Back](../README.md)